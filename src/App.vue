<template>
  <div id="app">
    <el-input type="textarea" :rows="10" placeholder="点击生成数据按钮" v-model="srcData" style="font-size:16px;"/>
    <div>
      输入指定点P1(lng,lat)
      <el-input v-model="p1" style="width:250px" />
      输入指定点P2(lng,lat)
      <el-input v-model="p2" style="width:250px" />
      <el-button type="primary" @click="GenData" style="margin-left:20px;">生成数据</el-button>
      <el-button
        type="primary"
        @click="RunDemo"
        style="margin-left:20px;"
        :disabled="srcData.length == 0"
      >调用线路规划</el-button>
      <el-link v-if="desdata.length > 0" target="blank" type="primary" :href="mapUrl()">地图显示</el-link>
    </div>
    <el-input type="textarea" :rows="10" :value="tostring(desdata)" readonly style="font-size:16px;"></el-input>
  </div>
</template>

<script>
import { GenerateData } from "@/api/gendata";
import { GetPointsInPolylineBySpecificRange } from "@/api/gis_api";
import { Polyline } from "@/api/polyline";
import { Point } from "@/api/point";
export default {
  name: "app",
  data() {
    return {
      // 输入参数之组成Polyline的点集合
      srcData: "118.869354,32.039154;118.869064,32.038952;118.868713,32.038712;118.868675,32.038692;118.868065,32.038372;118.867455,32.038116;118.867126,32.037998;118.866798,32.037872;118.866402,32.037735;118.865616,32.037457;118.865196,32.037281;118.864647,32.037037;118.86441,32.036915;118.863091,32.036243;118.862808,32.036133;118.862801,32.036125;118.862709,32.036098;118.86248,32.036037;118.862198,32.035988;118.861664,32.035946;118.860771,32.03587;118.859512,32.035732;118.85923,32.035706;118.858826,32.03566;118.858749,32.035652;118.858452,32.035614;118.857582,32.035511;118.856667,32.035419;118.856232,32.035408;118.855927,32.035423;118.855675,32.035465;118.855164,32.035591;118.85479,32.035694;118.853912,32.035938;118.853912,32.035942;118.853226,32.036133;118.852989,32.036194;118.85273,32.03627;118.852165,32.03643;118.851936,32.036503;118.85112,32.036751;118.851074,32.036648;118.85096,32.036442;118.850784,32.036133;118.850685,32.035942;118.850479,32.035568;118.85051,32.035145;118.85051,32.035141;118.85054,32.034714;118.850548,32.034592;118.850578,32.034126;118.850853,32.030464;118.850891,32.029991;118.850891,32.029987;118.85096,32.029133;118.850967,32.029045;118.851105,32.026863;118.851112,32.026649;118.851112,32.026646;118.851219,32.025143;118.851265,32.024395;118.851341,32.023533;118.850594,32.023506;118.850098,32.023476;118.849602,32.023441;118.849144,32.02343;118.84906,32.023426;118.848686,32.023403;118.848412,32.023388;118.847641,32.023361;118.847244,32.023342;118.847076,32.023338;118.846664,32.023331;118.846436,32.023323;118.845741,32.023319;118.844864,32.023323;118.844757,32.023273;118.844948,32.022442;118.845024,32.022118;118.845184,32.021301;118.845337,32.020496;118.84539,32.02029;118.845444,32.019695;118.845428,32.019497;118.845367,32.01902;118.845337,32.018883;118.84523,32.01852;118.845085,32.018009;118.844986,32.017693;118.844803,32.01709;118.844749,32.016911;118.844666,32.016663;118.844505,32.016201;118.844429,32.015884;118.844353,32.015591;118.844223,32.014935;118.844009,32.014156;118.843918,32.013859;118.843803,32.013504;118.843483,32.012539;118.843292,32.01207;118.842903,32.011162;118.842613,32.010479;118.842552,32.010338;118.842194,32.009422;118.841789,32.008411;118.84169,32.008141;118.841476,32.007233;118.841278,32.006458;118.841225,32.006203;118.841209,32.005997;118.841232,32.00576;118.841339,32.00547;118.841415,32.005352;118.84201,32.004723;118.842117,32.004681;118.842255,32.004562;118.842545,32.004322;118.842842,32.004131;118.843063,32.004021;118.84346,32.00388;118.844055,32.003654;118.84417,32.003613;118.844711,32.003387;118.845001,32.003246;118.845139,32.003174;118.84523,32.003117;118.845772,32.002796;118.846207,32.002491;118.848015,32.001125;118.849129,32.000275;118.849274,32.000168;118.849487,32.0;118.849556,31.999918;118.849617,31.99984;118.849709,31.999586;118.849731,31.999548;118.849976,31.999125;118.850006,31.999041;118.850098,31.998806;118.850166,31.998615;118.850304,31.998264;118.850487,31.997843;118.850548,31.997728;118.850685,31.997564;118.850998,31.997244;118.851212,31.997044;118.852257,31.996046;118.852348,31.99597;118.852554,31.995773;118.853226,31.995142;118.853325,31.99506;118.85405,31.994371;118.854729,31.993767;118.855019,31.993475;118.855286,31.993233;118.85569,31.992809;118.856216,31.992188;118.856224,31.992174;118.856537,31.991804;118.856712,31.991615;118.856972,31.991394;118.858063,31.990486;118.858971,31.989653;118.858986,31.989635;118.860268,31.988464;118.862007,31.986904;118.862808,31.986242;118.863281,31.985828;118.863655,31.985491;118.863663,31.985395;118.864204,31.9849;118.864258,31.984858;118.864792,31.984367;118.865166,31.984026;118.866844,31.982573;118.867218,31.982244;118.868256,31.981325;118.868401,31.981197;118.869225,31.980465;118.869568,31.98016;118.869904,31.979862;118.870277,31.979536;118.870872,31.978989;118.870956,31.978916;118.871643,31.978277;118.87207,31.9779;118.872124,31.977846;118.872986,31.977072;118.873627,31.976458;118.874039,31.97608;118.874153,31.975973;118.874466,31.975706;118.874748,31.975464;118.874809,31.975418;118.874863,31.975374;118.874939,31.975309;118.875282,31.97504;118.87587,31.974518;118.877251,31.973307;118.876808,31.972979;118.87648,31.972696;118.876305,31.972504",
      desdata: [],
      p1:'118.869354,32.039154',
      p2:'118.878853,31.959661'
    };
  },
  filters: {},
  methods: {
    tostring(pts) {
      var ary = [];
      pts.forEach(p => {
        ary.push(`${p.x},${p.y}`);
      });
      return ary.join(";");
    },
    GenData() {
      this.srcData = this.tostring(GenerateData());
    },
    RunDemo() {
      // 生成参数,折线polyline,pStart,pEnd
      var polyline = new Polyline(this.parse2PtArray(this.srcData));
      var p1Array = this.p1.split(',');
      var p2Array = this.p2.split(',');
      var pStart = new Point(parseFloat(p1Array[0]), parseFloat(p1Array[1]));
      var pEnd = new Point(parseFloat(p2Array[0]), parseFloat(p2Array[1]));
      // 调用并输出
      this.desdata = GetPointsInPolylineBySpecificRange(polyline, pStart, pEnd);
    },
    // 将字符串解析为点数组
    parse2PtArray(data) {
      var pts = [];
      data.split(";").forEach(item => {
        if(item.length > 0){
          var tmp = item.split(",");
          pts.push(new Point(parseFloat(tmp[0]), parseFloat(tmp[1])));
        }
      });
      return pts;
    },
    mapUrl(){
      var url = 'http://127.0.0.1:5500/gislib/demo.html';
      url+= `?source=${this.srcData}&des=${this.tostring(this.desdata)}`
      console.log(url);
      return url;
    }
  }
};
</script>

<style lang="scss" scoped>
.el-button {
  margin: 20px 10px;
}
span {
  margin: 0px 10px;
}
</style>